<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cartos: Interactive Geo-Political Maps (India)</title>

    <link rel="stylesheet" type="text/css" href="vendor/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap-responsive.css"/>

    <!-- Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- Less stylesheets -->
    <link rel="stylesheet/less" type="text/css" href="static/css/base.less"/>

    <script src="vendor/less-1.3.3.min.js"></script>
    <script src="vendor/jquery.js"></script>
    <script src="vendor/bootstrap.js"></script>
  </head>
  <body>
    <div class="row full-height">
      <div id="svg-container" class="span8">
      </div>
      <div class="span4 sidebar">
          <div class="header span4">
            header
          </div>
          <div id="state-values" class="main">
          </div>
          <div class="text-center footer span4">
            <span class="wrapper">
              <button id="draw">Draw</button>
              <input type="reset" id="reset"/>
            </span>
          </div>
      </div>
    </div>

    <script src="vendor/underscore.js"></script>
    <script src="vendor/require.js"></script>
    <script>
      function init(Map, inventory) {
        var svg_elem = document.createElement('object')
        svg_elem.data = 'map-inkscape.svg';
        svg_elem.type = 'image/svg+xml';

        svg_elem.onload = function() {
          var svg_doc = svg_elem.contentDocument,
              m = new Map(svg_doc);

          /* The meat of the code must lie here */

          // Assign a listener to the submit button
          document.getElementById('draw').onclick = function () {
            var specifier = {};
            _.each(inventory.states, function(state) {
              var val = document.getElementById(state).value;

              if (val != '') {
                specifier[state] = val;
              }
            });
            
            m.paint(specifier);
          };

          // Provide the initial accent colours for the map. Random colours
          // from a scale.
          var specifier = {};
          _.each(inventory.states, function(state) {
            specifier[state] = "rgb( " + Math.ceil(Math.random() * 50 + 170) + ","
                                   + Math.ceil(Math.random() * 50 + 170) + ","
                                   + Math.ceil(Math.random() * 50 + 170) + ")";
          });

          m.paint(specifier);
        };

        document.getElementById('svg-container').appendChild(svg_elem);
      };

      function createStateBoxes(inventory) {
        var ul = document.createElement('ul');

        _.each(_.zip(inventory.states, inventory.human_states), function(state_block) {
          var li = document.createElement('li')
          , tb = document.createElement('input')
          , sp = document.createElement('span')
          , lb = document.createElement('label');

          tb['type'] = 'text';
          tb['class'] = 'state-value';
          tb['id'] = state_block[0];
          tb['name'] = state_block[0];

          lb.htmlFor = state_block[0];

          sp.innerText = state_block[1];
          sp.textContent = state_block[1];

          li.appendChild(tb);
          li.appendChild(sp);

          lb.appendChild(li);

          ul.appendChild(lb);
        });

        document.getElementById('state-values').appendChild(ul);
      };

      requirejs.config({
        baseUrl: 'static/javascript/'
      });

      requirejs(['map', 'inventory'], init);
      requirejs(['inventory'], createStateBoxes);
    </script>
  </body>
</html>
